---
title: "01_BLAST"
output: html_document
---

"This file is part of the process of me learning BLAST in the command pipeline! I am excited about it :)"


```{bash}
# make database 
sudo makeblastdb \
-in ../Data/uniprot_sprot_s2025_04.fasta \
-dbtype prot \
-out ../blastdb/uniprot_sprot_s2025_04
# explore file
head -3 ../Data/protein_two_spot.faa
echo "how many sequences are there?"
grep -c ">" ../Data/protein_two_spot.faa

```
```{R}
#read fasta
fasta_file <- "../Data/protein_two_spot.faa" 
sequences <- readDNAStringSet(fasta_file, format="fasta",
               nrec=-1L, skip=0L, seek.first.rec=FALSE,
               use.names=TRUE, with.qualities=FALSE)
sequence_lengths <- width(sequences)
sequence_lengths_df <- data.frame(Length = sequence_lengths)
```
```{R}
# Plot histogram using ggplot2
ggplot(sequence_lengths_df, aes(x = Length)) +
  geom_histogram(binwidth = 3, color = "red", fill = "blue", alpha = 0.1) +
  labs(title = "Histogram of Sequence Lengths",
       x = "Sequence Length",
       y = "Frequency") +
  theme_minimal()
# Calculate base composition 
base_composition <- alphabetFrequency(sequences, baseOnly = TRUE)
#convert do data frame, reshape for ggplot2
base_composition_df <- as.data.frame(base_composition)
base_composition_df$ID <- rownames(base_composition_df)
```
```{bash}
sudo blastx \
-query ../Data/Protein_Two_Spot.faa\
-db ../blastdb/uniprot_sprot_s2025_04.fasta \
-out ../Output/Two_Spot_uniprot_blastx.tab \
-evalue 1E-20 \
-num_threads 20 \
-max_target_seqs 3 \
-outfmt 7
```
```{bash}
head -3 ../Output/Two_Spot_uniprot_blastx.tab
ls ../Output/Two_Spot_uniprot_blastx.tab
echo "Number of lines in output"
wc -l ../Output/Two_Spot_uniprot_blastx.tab
# note, nothing seems to be moving to this file, must resolve issue
```

```{R}
base_composition_melted <- reshape2::melt(base_composition_df, id.vars = "ID",variable.name = "Base", value.name = "Count")
# plot base compostion with a bar chart
ggplot(base_composition_melted, aes(x = Base, y = Count, fill = Base))+
  geom_bar(stat = "identity", position = "dodge", color = "black")+
  labs(title = "Base Composition",
       x = "Base",
       y = "Count") +
  theme_minimal() +
  scale_fill_manual(values = c("A" = "green", "C"="blue", "G"="yellow", "T"= "red"))
# Count CG motifs in each sequence
count_cg_motifs <- function(sequence) {
  cg_motif <- "CG"
  return(length(gregexpr(cg_motif, sequence, fixed = TRUE)[[1]]))
}

cg_motifs_counts <- sapply(sequences, count_cg_motifs)

# Create a data frame
cg_motifs_counts_df <- data.frame(CG_Count = cg_motifs_counts)

# Plot CG motifs distribution using ggplot2
ggplot(cg_motifs_counts_df, aes(x = CG_Count)) +
  geom_histogram(binwidth = 1, color = "black", fill = "blue", alpha = 0.75) +
  labs(title = "Distribution of CG Motifs",
       x = "Number of CG Motifs",
       y = "Frequency") +
  theme_minimal()
```
  